{{/* widgets/tags.html */}}
{{ if .Site.Params.widgets.tags }}
{{ if isset .Site.Taxonomies "tags" }}
{{ if not (eq (len .Site.Taxonomies.tags) 0) }}
{{ $listFolders := .Params.list_folders | default (slice) }}

<div class="panel sidebar-menu">
    <div class="panel-heading">
        <h3 class="panel-title">{{ i18n "tagsTitle" }}</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            {{ $current := . }}
            {{ range $name, $items := .Site.Taxonomies.tags }}
                {{/* Filter: only show tag if any of its pages belong to the listed folders */}}
                {{ $showTag := false }}
                {{ range $items.Pages }}
                    {{ $section := (path.Dir .File.Path) }}
                    {{ if in $listFolders $section }}
                        {{ $showTag = true }}
                    {{ end }}
                {{ end }}
                {{ if $showTag }}
                    <li {{ if eq $current.RelPermalink (printf "%s/%s/" ("tags" | relLangURL) ($name | urlize | lower)) }}class="active"{{ end }}>
                        <a href="{{ "tags/" | relLangURL }}{{ $name | urlize | lower }}">
                            <i class="fas fa-tags"></i> {{ $name }}
                        </a>
                    </li>
                {{ end }}
            {{ end }}
        </ul>
    </div>
</div>

{{ end }}
{{ end }}
{{ end }}
